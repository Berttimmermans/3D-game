!function(){function a(){return{pos:{x:460,y:320,z:0},speed:2,mode:"moving",directory:"img/LVL-1-logic-map.png"}}function b(){this.d=a(),this.charachter=$(".charachter")[0],this.logicMap=document.createElement("canvas"),this.logicMapContext=this.logicMap.getContext("2d");var b=new Image,c=this;b.onload=function(){c.logicMap.width=this.width,c.logicMap.height=this.height,c.logicMapContext.drawImage(this,0,0)},b.src=this.d.directory}b.prototype.init=function(){this.updatePos()},b.prototype.walk=function(a){var b=this.readMap(a.x,a.y);return b=0!=b?b:this.readMap(0,a.y),b=0!=b?b:this.readMap(a.x,0),0==b.x&&0==b.y?!1:b.z-this.d.pos.z>10?!1:(this.d.pos=b,void this.updatePos())},b.prototype.updatePos=function(){this.charachter.style.webkitTransform="translate3D("+this.d.pos.x+"px,"+this.d.pos.y+"px,"+this.d.pos.z+"px)"},b.prototype.readMap=function(a,b){var a=this.d.pos.x+a,b=this.d.pos.y+b,c=this.logicMapContext.getImageData(a,b,1,1).data;return c[0]==c[1]&&c[1]==c[2]?{x:a,y:b,z:parseInt(-c[0]/2.55+100)}:!1},b.prototype.dPad=function(a){return this.controlDispatcher("dPad",a)},b.prototype.controlDispatcher=function(a,b){return this.controlReceiver(a,b)},b.prototype.controlReceiver=function(a,b){"dPad"==a&&this.walk(b)},window.Game=b}(),function(){function a(a){this.game=a,this.pos={x:0,y:0},this.update,this.interval=10}a.prototype=function(){function b(){var a=this;$(document).keydown(function(b){var c=b.which;38==c&&(a.pos.y=-1),39==c&&(a.pos.x=1),40==c&&(a.pos.y=1),37==c&&(a.pos.x=-1),(38==c||39==c||40==c||37==c)&&(clearInterval(a.update),a.update=setInterval(function(){return a.game.dPad(a.pos)},a.interval))}),$(document).keyup(function(b){var c=b.which;return(38==c||40==c)&&(a.pos.y=0),(39==c||37==c)&&(a.pos.x=0),0==a.pos.x&&0==a.pos.y&&clearInterval(a.update),38==c||39==c||40==c||37==c?a.game.dPad(a.pos):void 0})}return{constructor:a,init:function(){return this._(b)()},_:function(a){var b=this;return function(){return a.apply(b,arguments)}}}}(),window.Keyboard=a}(),$(document).ready(function(){var a=new Game;a.init();var b=new Keyboard(a);b.init();var c=new Touch(a);c.init()}),function(){function a(a){this.game=a,this.pos={x:0,y:0},this.size=160,this.buttonSize=80,this.update,this.interval=10,this.iPad=null!=navigator.userAgent.match(/iPad/i),this.iPhone=null!=navigator.userAgent.match(/iPhone/i),this.iPod=null!=navigator.userAgent.match(/iPod/i),this.android=null!=navigator.userAgent.match(/Android/i)}a.prototype.init=function(){(1==this.iPad||1==this.iPhone||1==this.iPod||1==this.android)&&this.build()},a.prototype.build=function(){var a=this;$("body").append('<div class="controls"></div>'),$(".controls").append('<div id="dPad"><div id="dPad-stick"></div></</div>'),$("body").bind("touchstart",function(a){return a.preventDefault()}),$("#dPad").bind("touchstart",function(){a.update=setInterval(function(){return a.game.dPad(a.pos)},a.interval),$(this).addClass("active")}).bind("touchmove",function(b){var c=b.originalEvent.touches[0].pageX,d=b.originalEvent.touches[0].pageY,e=$(this).position(),f=c-e.left-a.size/2,g=d-e.top-a.size/2,h=(a.size-a.buttonSize)/2;-h>f&&(f=-h),f>h&&(f=h),-h>g&&(g=-h),g>h&&(g=h),a.translate(f,g),a.pos.x=f<-(a.size/8)?-1:f>a.size/8?1:0,a.pos.y=g<-(a.size/8)?-1:g>a.size/8?1:0}).bind("touchend",function(){return clearInterval(a.update),$(".controls .active").removeClass("active"),a.pos={x:0,y:0},a.translate(0,0),a.game.dPad(a.pos)})},a.prototype.translate=function(a,b){object=document.getElementById("dPad-stick"),object.style.webkitTransform="translate("+a+"px,"+b+"px)"},window.Touch=a}();